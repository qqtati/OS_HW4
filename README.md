# ИДЗ-4

## Талалаев Геннадий Алексеевич БПИ219 Вариант 36

## Условие задачи:

Задача о сельской библиотеке. В библиотеке имеется N книг, Каждая из книг в одном экземпляре. M читателей регулярно за- глядывают в библиотеку, выбирает для чтения одну книгу и читает ее некоторое количество дней. Если желаемой книги нет, то чи- татель дожидается от библиотекаря информации об ее появлении и приходит в библиотеку, чтобы специально забрать ее. Возмож- на ситуация, когда несколько читателей конкурируют из-за этой популярной книги. Создать приложение, моделирующее за- данный процесс. Библиотекарь — сервер. Читатели клиенты.

### Сущности:

- Сервер библеотека: Управляет управляет библиотекой и выдает книги.
- Клиенты-посетители: взаимодействуют с библиотекой и книгами.
- Наблюдатель.

### Сценарий и взаимодействия:
0. Общий сценарий
    - Сервер создает UDP-сокет и начинает прослушивать заданный порт.
    - Клиенты отправляют запросы на сервер по UDP-протоколу.
    - Сервер принимает запросы и обрабатывает их без установления постоянного соединения.
    - Клиент может отправлять запросы на получение книги или возврат книги. 
    - Сервер обрабатывает запросы, обновляет состояние книг и отправляет ответы клиенту.
    - Процесс повторяется для каждого клиента, пока сервер не завершит свою работу.

1. Взаимодействие :
   - Функция DieWithError используется для обработки ошибок. Если происходит ошибка, функция выводит сообщение об ошибке и завершает программу.
   - Функция handleClient представляет обработку запросов от клиентов.
   - Функция createUDPSocket создает UDP-сокет, привязывает его к заданному порту и возвращает его дескриптор.
   - В функции main происходит инициализация переменных и запуск сервера.

### 4-5
- компилировать 
    gcc library.c -o library -lrt -lpthread
    gcc reader.c -o reader
- запускать
    ./library 8000 <кол-во книг>
    ./reader 127.0.0.1 8000 <кол-во книг>
    читателей может быть несколько

### 6-7
- компилировать
    gcc library.c -o library -lrt -lpthread
    gcc reader.c -o reader
    gcc observer.c -o observer
- запускать
    ./library 224.0.0.1 8001 8000 2
    ./reader 127.0.0.1 8000 2
    ./observer 224.0.0.1 8001
    читателей может быть несколько


### 8
На оценку 8 наблюдателей может быть несколько и их можно подключать-отключать через ctrl-c прямо когда все работает.

